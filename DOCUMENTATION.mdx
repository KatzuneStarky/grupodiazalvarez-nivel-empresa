---
Titulo: Grupo Diaz Alvarez - Sistema de GestiÃ³n LogÃ­stica
Descripcion: DocumentaciÃ³n completa del sistema de gestiÃ³n empresarial para Grupo Diaz Alvarez
Version: 4.5.0
---

# Grupo Diaz Alvarez - Sistema de GestiÃ³n LogÃ­stica

Sistema integral de gestiÃ³n empresarial desarrollado con Next.js 15, diseÃ±ado especÃ­ficamente para la gestiÃ³n de operaciones logÃ­sticas de transporte de combustible.

## ğŸ“‹ Tabla de Contenidos

- [DescripciÃ³n General](#descripciÃ³n-general)
- [TecnologÃ­as](#tecnologÃ­as)
- [Arquitectura](#arquitectura)
- [MÃ³dulos Principales](#mÃ³dulos-principales)
- [InstalaciÃ³n](#instalaciÃ³n)
- [ConfiguraciÃ³n](#configuraciÃ³n)
- [Estructura del Proyecto](#estructura-del-proyecto)
- [GuÃ­a de Desarrollo](#guÃ­a-de-desarrollo)
- [API y Servicios](#api-y-servicios)
- [Seguridad y AutenticaciÃ³n](#seguridad-y-autenticaciÃ³n)
- [Despliegue](#despliegue)

---

## ğŸ¯ DescripciÃ³n General

El sistema de gestiÃ³n de Grupo Diaz Alvarez es una plataforma web empresarial que centraliza la gestiÃ³n de:

- **Flota de vehÃ­culos**: Control completo de pipas de combustible
- **Operadores**: GestiÃ³n de personal y documentaciÃ³n
- **Viajes y rutas**: Seguimiento de operaciones logÃ­sticas
- **Mantenimiento**: ProgramaciÃ³n y control de servicios
- **Clientes y estaciones**: AdministraciÃ³n de relaciones comerciales
- **DocumentaciÃ³n**: Control de vencimientos y cumplimiento normativo
- **Reportes y anÃ¡lisis**: Dashboards interactivos con mÃ©tricas en tiempo real

### CaracterÃ­sticas Principales

âœ… **Multi-empresa**: Soporte para mÃºltiples empresas del grupo  
âœ… **Multi-Ã¡rea**: GestiÃ³n independiente por departamentos (LogÃ­stica, Mantenimiento)  
âœ… **Tiempo real**: SincronizaciÃ³n instantÃ¡nea con Firebase  
âœ… **Responsive**: DiseÃ±o adaptable a dispositivos mÃ³viles y desktop  
âœ… **Notificaciones**: Sistema de alertas y recordatorios  
âœ… **ExportaciÃ³n**: GeneraciÃ³n de reportes en Excel y PDF  
âœ… **Control de acceso**: Sistema de roles y permisos granular  

---

## ğŸ›  TecnologÃ­as

### Frontend

- **Framework**: [Next.js 15.3.3](https://nextjs.org/) (App Router)
- **React**: 18.3.1
- **TypeScript**: 5.9.3
- **Styling**: 
  - Tailwind CSS 4
  - Chakra UI
  - Radix UI Components
  - Framer Motion (animaciones)
- **State Management**: React Context API
- **Forms**: React Hook Form + Zod
- **Charts**: Recharts
- **Maps**: Leaflet
- **Calendar**: FullCalendar

### Backend & Database

- **Database**: Firebase Firestore (NoSQL)
- **Authentication**: Firebase Auth
- **Storage**: Firebase Storage
- **Cloud Functions**: Firebase Functions
- **Real-time**: Firebase Realtime Database

### Servicios Externos

- **Email**: Resend
- **SMS**: Twilio
- **FacturaciÃ³n**: Facturapi
- **Notificaciones**: Firebase Cloud Messaging

### Herramientas de Desarrollo

- **Testing**: Vitest + Testing Library
- **Linting**: ESLint
- **Type Checking**: TypeScript
- **Package Manager**: npm
- **Version Control**: Git

---

## ğŸ— Arquitectura

### Arquitectura de Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PresentaciÃ³n (UI)               â”‚
â”‚  - Pages (App Router)                   â”‚
â”‚  - Components (Shared/Module-specific)  â”‚
â”‚  - Layouts                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LÃ³gica de Negocio               â”‚
â”‚  - Hooks personalizados                 â”‚
â”‚  - Context Providers                    â”‚
â”‚  - Utilidades y funciones               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Capa de Datos                   â”‚
â”‚  - Firebase SDK                         â”‚
â”‚  - API Routes                           â”‚
â”‚  - Server Actions                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Servicios Externos              â”‚
â”‚  - Firebase (Auth, Firestore, Storage) â”‚
â”‚  - Resend, Twilio, Facturapi           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PatrÃ³n de DiseÃ±o

El proyecto sigue una arquitectura **modular** con separaciÃ³n de responsabilidades:

- **Modules**: Cada Ã¡rea funcional (logÃ­stica, mantenimiento) es un mÃ³dulo independiente
- **Shared Components**: Componentes reutilizables en `components/`
- **Context API**: GestiÃ³n de estado global por contexto
- **Custom Hooks**: LÃ³gica reutilizable encapsulada
- **Server Components**: Renderizado del lado del servidor cuando es posible

---

## ğŸ“¦ MÃ³dulos Principales

### 1. MÃ³dulo de LogÃ­stica (`/modules/logistica`)

GestiÃ³n completa de operaciones de transporte de combustible.

#### SubmÃ³dulos:

**Equipos** (`/equipos`)
- Dashboard de flota con KPIs
- GestiÃ³n de pipas y tanques
- Control de documentaciÃ³n vehicular
- Mantenimiento preventivo y correctivo
- Alertas de vencimientos

**Operadores** (`/bdd/operadores`)
- Base de datos de conductores
- DocumentaciÃ³n personal
- Licencias y certificaciones
- Historial de viajes

**Viajes** (`/reportes-viajes`)
- Registro de viajes realizados
- CÃ¡lculo de fletes
- Tracking de rutas
- Reportes por periodo

**Clientes** (`/bdd/clientes`)
- GestiÃ³n de clientes
- Estaciones de servicio
- Contratos y tarifas

**Rutas** (`/rutas`)
- DefiniciÃ³n de rutas
- CÃ¡lculo de distancias
- OptimizaciÃ³n de trayectos

### 2. MÃ³dulo de Mantenimiento (`/modules/mantenimiento`)

Control de mantenimientos preventivos y correctivos.

- ProgramaciÃ³n de servicios
- Historial de reparaciones
- Control de costos
- Proveedores de servicio

### 3. MÃ³dulo de AdministraciÃ³n (`/modules/administracion`)

GestiÃ³n administrativa y financiera.

- Control de usuarios
- ConfiguraciÃ³n de empresas
- GestiÃ³n de Ã¡reas
- Reportes financieros

### 4. MÃ³dulo de AutenticaciÃ³n (`/modules/auth`)

Sistema de autenticaciÃ³n y autorizaciÃ³n.

- Login/Registro
- RecuperaciÃ³n de contraseÃ±a
- VerificaciÃ³n de email
- Control de sesiones

---

## ğŸš€ InstalaciÃ³n

### Requisitos Previos

- Node.js 20.x o superior
- npm 10.x o superior
- Cuenta de Firebase
- Git

### Pasos de InstalaciÃ³n

1. **Clonar el repositorio**

```bash
git clone <repository-url>
cd grupodiazalvarez-nivel-empresa
```

2. **Instalar dependencias**

```bash
npm install
```

3. **Configurar variables de entorno**

Crear archivo `.env.local` en la raÃ­z del proyecto:

```env
# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_auth_domain
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_storage_bucket
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=your_measurement_id

# Firebase Admin SDK
FIREBASE_ADMIN_PROJECT_ID=your_project_id
FIREBASE_ADMIN_CLIENT_EMAIL=your_client_email
FIREBASE_ADMIN_PRIVATE_KEY=your_private_key

# Resend (Email)
RESEND_API_KEY=your_resend_api_key

# Twilio (SMS)
TWILIO_ACCOUNT_SID=your_twilio_sid
TWILIO_AUTH_TOKEN=your_twilio_token
TWILIO_PHONE_NUMBER=your_twilio_phone

# Facturapi
FACTURAPI_API_KEY=your_facturapi_key

# App Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

4. **Iniciar servidor de desarrollo**

```bash
npm run dev
```

La aplicaciÃ³n estarÃ¡ disponible en `http://localhost:3000`

---

## âš™ï¸ ConfiguraciÃ³n

### Firebase

1. Crear proyecto en [Firebase Console](https://console.firebase.google.com/)
2. Habilitar servicios:
   - Authentication (Email/Password)
   - Firestore Database
   - Storage
   - Cloud Messaging
3. Descargar `serviceAccountKey.json` y colocarlo en la raÃ­z del proyecto
4. Configurar reglas de seguridad en Firestore

### Estructura de Firestore

```
/empresas
  /{empresaId}
    - nombre: string
    - activa: boolean
    - areas: array
    
/usuarios
  /{userId}
    - email: string
    - nombre: string
    - rol: string
    - empresas: array
    
/equipos
  /{equipoId}
    - numeroEconomico: string
    - marca: string
    - modelo: string
    - year: number
    - estado: string
    - activo: boolean
    /tanques
      /{tanqueId}
    /mantenimientos
      /{mantenimientoId}
    /certificados
      /{certificadoId}
    
/reporteViajes
  /{viajeId}
    - fecha: timestamp
    - equipo: reference
    - operador: reference
    - cliente: reference
    - ruta: reference
    - flete: number
    - m3: number
```

---

## ğŸ“ Estructura del Proyecto

```
grupodiazalvarez-nivel-empresa/
â”œâ”€â”€ app/                          # App Router de Next.js
â”‚   â”œâ”€â”€ (auth)/                   # Rutas de autenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ registro/
â”‚   â”‚   â””â”€â”€ recuperar-password/
â”‚   â”œâ”€â”€ (main)/                   # Rutas principales protegidas
â”‚   â”‚   â””â”€â”€ [nombre]/             # Rutas dinÃ¡micas por empresa
â”‚   â”‚       â””â”€â”€ [name]/           # Rutas dinÃ¡micas por Ã¡rea
â”‚   â”‚           â”œâ”€â”€ equipos/
â”‚   â”‚           â”œâ”€â”€ operadores/
â”‚   â”‚           â”œâ”€â”€ viajes/
â”‚   â”‚           â””â”€â”€ ...
â”‚   â”œâ”€â”€ (root)/                   # Rutas raÃ­z
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â””â”€â”€ layout.tsx                # Layout principal
â”‚
â”œâ”€â”€ modules/                      # MÃ³dulos funcionales
â”‚   â”œâ”€â”€ logistica/                # MÃ³dulo de logÃ­stica
â”‚   â”‚   â”œâ”€â”€ equipos/
â”‚   â”‚   â”œâ”€â”€ bdd/
â”‚   â”‚   â”œâ”€â”€ reportes-viajes/
â”‚   â”‚   â”œâ”€â”€ rutas/
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”œâ”€â”€ mantenimiento/            # MÃ³dulo de mantenimiento
â”‚   â”œâ”€â”€ administracion/           # MÃ³dulo administrativo
â”‚   â””â”€â”€ auth/                     # MÃ³dulo de autenticaciÃ³n
â”‚
â”œâ”€â”€ components/                   # Componentes compartidos
â”‚   â”œâ”€â”€ ui/                       # Componentes UI base
â”‚   â”œâ”€â”€ custom/                   # Componentes personalizados
â”‚   â””â”€â”€ skeleton/                 # Componentes de carga
â”‚
â”œâ”€â”€ context/                      # Context Providers
â”‚   â”œâ”€â”€ auth-context.tsx
â”‚   â”œâ”€â”€ empresa-context.tsx
â”‚   â”œâ”€â”€ area-context.tsx
â”‚   â””â”€â”€ year-context.tsx
â”‚
â”œâ”€â”€ hooks/                        # Hooks personalizados globales
â”œâ”€â”€ lib/                          # LibrerÃ­as y utilidades
â”œâ”€â”€ types/                        # Definiciones de TypeScript
â”œâ”€â”€ utils/                        # Funciones utilitarias
â”œâ”€â”€ functions/                    # Funciones de negocio
â”œâ”€â”€ firebase/                     # ConfiguraciÃ³n de Firebase
â”œâ”€â”€ public/                       # Archivos estÃ¡ticos
â””â”€â”€ constants/                    # Constantes de la aplicaciÃ³n
```

---

## ğŸ’» GuÃ­a de Desarrollo

### Convenciones de CÃ³digo

#### Nomenclatura

- **Componentes**: PascalCase (`UserProfile.tsx`)
- **Hooks**: camelCase con prefijo `use` (`useAuth.ts`)
- **Utilidades**: camelCase (`formatDate.ts`)
- **Constantes**: UPPER_SNAKE_CASE (`MAX_FILE_SIZE`)
- **Tipos**: PascalCase con sufijo `Type` o interfaz (`UserType`, `IUser`)

#### Estructura de Componentes

```typescript
"use client" // Solo si es Client Component

import { useState } from "react"
import { Button } from "@/components/ui/button"

interface ComponentProps {
    title: string
    onAction?: () => void
}

export function Component({ title, onAction }: ComponentProps) {
    const [state, setState] = useState<string>("")
    
    return (
        <div>
            <h1>{title}</h1>
            <Button onClick={onAction}>Action</Button>
        </div>
    )
}
```

#### Hooks Personalizados

```typescript
"use client"

import { useState, useEffect } from "react"
import { collection, onSnapshot } from "firebase/firestore"
import { db } from "@/firebase/client"

export function useData() {
    const [data, setData] = useState<DataType[]>([])
    const [isLoading, setIsLoading] = useState(true)
    const [error, setError] = useState<Error | null>(null)
    
    useEffect(() => {
        const unsubscribe = onSnapshot(
            collection(db, "collection"),
            (snapshot) => {
                const items = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }))
                setData(items)
                setIsLoading(false)
            },
            (err) => {
                setError(err)
                setIsLoading(false)
            }
        )
        
        return () => unsubscribe()
    }, [])
    
    return { data, isLoading, error }
}
```

### Manejo de Estados de Carga

Todos los componentes que cargan datos deben implementar estados de carga:

```typescript
if (isLoading) {
    return <ComponentSkeleton />
}

if (error) {
    return <ErrorMessage error={error} />
}

return <ActualComponent data={data} />
```

### OptimizaciÃ³n de Rendimiento

- Usar `useMemo` para cÃ¡lculos costosos
- Usar `useCallback` para funciones pasadas como props
- Implementar lazy loading con `dynamic` de Next.js
- Usar Server Components cuando sea posible

```typescript
import dynamic from 'next/dynamic'

const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
    ssr: false,
    loading: () => <Skeleton />
})
```

### Testing

```bash
# Ejecutar tests
npm run test

# Ejecutar tests en modo watch
npm run test:watch
```

Ejemplo de test:

```typescript
import { render, screen } from '@testing-library/react'
import { Component } from './Component'

describe('Component', () => {
    it('renders correctly', () => {
        render(<Component title="Test" />)
        expect(screen.getByText('Test')).toBeInTheDocument()
    })
})
```

---

## ğŸ”Œ API y Servicios

### API Routes

Las API routes estÃ¡n en `app/api/`:

```typescript
// app/api/example/route.ts
import { NextRequest, NextResponse } from 'next/server'

export async function GET(request: NextRequest) {
    try {
        const data = await fetchData()
        return NextResponse.json({ data })
    } catch (error) {
        return NextResponse.json(
            { error: 'Error message' },
            { status: 500 }
        )
    }
}
```

### Server Actions

```typescript
"use server"

import { db } from "@/firebase/admin"

export async function createItem(data: ItemData) {
    try {
        const docRef = await db.collection('items').add(data)
        return { success: true, id: docRef.id }
    } catch (error) {
        return { success: false, error: error.message }
    }
}
```

### Servicios Firebase

#### AutenticaciÃ³n

```typescript
import { auth } from "@/firebase/client"
import { signInWithEmailAndPassword } from "firebase/auth"

const login = async (email: string, password: string) => {
    const userCredential = await signInWithEmailAndPassword(auth, email, password)
    return userCredential.user
}
```

#### Firestore

```typescript
import { db } from "@/firebase/client"
import { collection, getDocs, query, where } from "firebase/firestore"

const getItems = async (filter: string) => {
    const q = query(
        collection(db, "items"),
        where("status", "==", filter)
    )
    const snapshot = await getDocs(q)
    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))
}
```

---

## ğŸ” Seguridad y AutenticaciÃ³n

### Sistema de Roles

```typescript
enum RolUsuario {
    Super_Admin = "Super_Admin",
    Admin = "Admin",
    Gerente_Logistica = "Gerente_Logistica",
    Gerente_Mantenimiento = "Gerente_Mantenimiento",
    Coordinador_Logistica = "Coordinador_Logistica",
    Coordinador_Mantenimiento = "Coordinador_Mantenimiento",
    Operador = "Operador",
    Mecanico = "Mecanico"
}
```

### Control de Acceso

```typescript
// Middleware de protecciÃ³n de rutas
const checkAccess = (user: User, requiredRole: RolUsuario) => {
    if (!user) return false
    if (user.rol === RolUsuario.Super_Admin) return true
    return user.rol === requiredRole
}
```

### Reglas de Firestore

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /equipos/{equipoId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
        get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol in ['Super_Admin', 'Admin'];
    }
  }
}
```

---

## ğŸš¢ Despliegue

### Build de ProducciÃ³n

```bash
npm run build
```

### Despliegue en Vercel

1. Conectar repositorio en [Vercel](https://vercel.com)
2. Configurar variables de entorno
3. Deploy automÃ¡tico en cada push a main

### Variables de Entorno en ProducciÃ³n

Asegurarse de configurar todas las variables de entorno en el panel de Vercel:

- Firebase credentials
- API keys de servicios externos
- URLs de producciÃ³n

### Optimizaciones de ProducciÃ³n

- CompresiÃ³n de assets
- OptimizaciÃ³n de imÃ¡genes con Next.js Image
- Code splitting automÃ¡tico
- Caching de rutas estÃ¡ticas

---

## ğŸ“Š MÃ©tricas y Monitoreo

### Analytics

- Firebase Analytics integrado
- Tracking de eventos personalizados
- MÃ©tricas de rendimiento

### Error Tracking

- Console logging en desarrollo
- Error boundaries en producciÃ³n
- Reportes de errores a Firebase

---

## ğŸ¤ ContribuciÃ³n

### Flujo de Trabajo

1. Crear branch desde `main`
2. Desarrollar feature
3. Ejecutar tests y linting
4. Crear Pull Request
5. Code review
6. Merge a `main`

### Commits

Seguir convenciÃ³n de commits semÃ¡nticos:

```
feat: nueva funcionalidad
fix: correcciÃ³n de bug
docs: cambios en documentaciÃ³n
style: cambios de formato
refactor: refactorizaciÃ³n de cÃ³digo
test: agregar o modificar tests
chore: tareas de mantenimiento
```

---

## ğŸ“ Licencia

Proyecto privado - Grupo Diaz Alvarez Â© 2025

---

## ğŸ“ Soporte

Para soporte tÃ©cnico o consultas:
- Email: soporte@grupodiazalvarez.com
- DocumentaciÃ³n interna: [Link]

---

**Ãšltima actualizaciÃ³n**: Noviembre 2025  
**VersiÃ³n**: 4.5.0
